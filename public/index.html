<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083; background-color: #171818}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #36c0a0; -webkit-text-stroke: #36c0a0}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s8 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s9 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s10 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s11 {font-kerning: none}
    span.s12 {font-kerning: none; color: #cacaca; -webkit-text-stroke: 0px #cacaca}
    span.s13 {font-kerning: none; color: #d4d4d4; -webkit-text-stroke: 0px #d4d4d4}
    span.s14 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s15 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"ja"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">AI音声練習アシスタント (Vercel版)</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&amp;display=swap"</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s4"> </span><span class="s1">'Inter'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'Noto Sans JP'</span><span class="s7">,</span><span class="s4"> </span><span class="s5">sans-serif</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #121212</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #E0E0E0</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.chat-bubble</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">max-width:</span><span class="s1"> </span><span class="s8">75%</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s8">12px</span><span class="s1"> </span><span class="s8">16px</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s8">20px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">word-wrap:</span><span class="s1"> </span><span class="s5">break-word</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">line-height:</span><span class="s1"> </span><span class="s8">1.6</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.user-bubble</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #3B82F6</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s5">white</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">align-self:</span><span class="s1"> </span><span class="s5">flex-end</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-bottom-right-radius:</span><span class="s4"> </span><span class="s8">4px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.assistant-bubble</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #374151</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #F3F4F6</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">align-self:</span><span class="s1"> </span><span class="s5">flex-start</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-bottom-left-radius:</span><span class="s4"> </span><span class="s8">4px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.error-bubble</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #991B1B</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #FEE2E2</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">align-self:</span><span class="s1"> </span><span class="s5">flex-start</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">#recordButton.recording::after</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">content:</span><span class="s1"> </span><span class="s9">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">position:</span><span class="s1"> </span><span class="s5">absolute</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">top:</span><span class="s4"> </span><span class="s8">0</span><span class="s7">;</span><span class="s4"> </span><span class="s1">left:</span><span class="s4"> </span><span class="s8">0</span><span class="s7">;</span><span class="s4"> </span><span class="s1">right:</span><span class="s4"> </span><span class="s8">0</span><span class="s7">;</span><span class="s4"> </span><span class="s1">bottom:</span><span class="s4"> </span><span class="s8">0</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s8">9999px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #EF4444</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s1"> </span><span class="s5">pulse</span><span class="s1"> </span><span class="s8">1.5s</span><span class="s1"> </span><span class="s5">infinite</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s1"> </span><span class="s5">pulse</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">0%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">scale(</span><span class="s8">0.95</span><span class="s5">)</span><span class="s7">;</span><span class="s1"> </span><span class="s2">opacity:</span><span class="s1"> </span><span class="s8">0.7</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">70%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">scale(</span><span class="s8">1.2</span><span class="s5">)</span><span class="s7">;</span><span class="s1"> </span><span class="s2">opacity:</span><span class="s1"> </span><span class="s8">0</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">100%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">scale(</span><span class="s8">0.95</span><span class="s5">)</span><span class="s7">;</span><span class="s1"> </span><span class="s2">opacity:</span><span class="s1"> </span><span class="s8">0</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s6">.fade-in</span><span class="s4"> </span><span class="s7">{</span><span class="s4"> </span><span class="s2">animation:</span><span class="s4"> </span><span class="s1">fadeIn</span><span class="s4"> </span><span class="s8">0.5s</span><span class="s4"> </span><span class="s1">ease-in-out</span><span class="s7">;</span><span class="s4"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s1"> </span><span class="s5">fadeIn</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s5">from</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">opacity:</span><span class="s1"> </span><span class="s8">0</span><span class="s7">;</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">translateY(</span><span class="s8">10px</span><span class="s5">)</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s5">to</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">opacity:</span><span class="s1"> </span><span class="s8">1</span><span class="s7">;</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">translateY(</span><span class="s8">0</span><span class="s5">)</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.mode-button</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #2563EB</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s5">white</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s8">24px</span><span class="s1"> </span><span class="s8">32px</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s8">12px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-size:</span><span class="s1"> </span><span class="s8">1.25rem</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s8">600</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s1"> </span><span class="s5">all</span><span class="s1"> </span><span class="s8">0.3s</span><span class="s1"> </span><span class="s5">ease</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s8">0</span><span class="s1"> </span><span class="s8">4px</span><span class="s1"> </span><span class="s8">6px</span><span class="s1"> </span><span class="s5">rgba(</span><span class="s8">0</span><span class="s7">,</span><span class="s1"> </span><span class="s8">0</span><span class="s7">,</span><span class="s1"> </span><span class="s8">0</span><span class="s7">,</span><span class="s1"> </span><span class="s8">0.1</span><span class="s5">)</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.mode-button:hover</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #1D4ED8</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">translateY(</span><span class="s8">-2px</span><span class="s5">)</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s8">0</span><span class="s1"> </span><span class="s8">8px</span><span class="s1"> </span><span class="s8">12px</span><span class="s1"> </span><span class="s5">rgba(</span><span class="s8">0</span><span class="s7">,</span><span class="s1"> </span><span class="s8">0</span><span class="s7">,</span><span class="s1"> </span><span class="s8">0</span><span class="s7">,</span><span class="s1"> </span><span class="s8">0.15</span><span class="s5">)</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center justify-center min-h-screen bg-gray-900 text-white p-4"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"mode-selection"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-3xl md:text-4xl font-bold mb-10 text-gray-100"</span><span class="s3">&gt;</span><span class="s4">練習メニューを選択してください</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 md:grid-cols-3 gap-6"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s1"> </span><span class="s2">data-mode</span><span class="s3">=</span><span class="s5">"discussion"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"mode-button"</span><span class="s3">&gt;</span><span class="s1">ディスカッションの練習</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">data-mode</span><span class="s3">=</span><span class="s1">"brainstorming"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mode-button"</span><span class="s3">&gt;</span><span class="s4">ブレーンストーミングの練習</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s1"> </span><span class="s2">data-mode</span><span class="s3">=</span><span class="s5">"ideation"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"mode-button"</span><span class="s3">&gt;</span><span class="s1">アイデア出しの練習</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"chatbot-container"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full max-w-2xl mx-auto p-4 md:p-6 bg-gray-800 rounded-2xl shadow-2xl flex-col h-[90vh] hidden"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">header</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center pb-4 border-b border-gray-700"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"chatbot-title"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-gray-100"</span><span class="s3">&gt;</span><span class="s4">AIアシスタント</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"status"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sm text-gray-400 mt-1"</span><span class="s3">&gt;</span><span class="s4">下のボタンを押して応答してください</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">header</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"chat-container"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-grow my-4 p-4 overflow-y-auto flex flex-col gap-4 bg-gray-900/50 rounded-lg"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col items-center pt-4 border-t border-gray-700"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"recordButton"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"relative w-20 h-20 bg-blue-600 hover:bg-blue-700 transition-all duration-300 rounded-full flex items-center justify-center shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-500/50"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">svg</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"micIcon"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-10 h-10 text-white"</span><span class="s4"> </span><span class="s2">fill</span><span class="s3">=</span><span class="s1">"none"</span><span class="s4"> </span><span class="s2">stroke</span><span class="s3">=</span><span class="s1">"currentColor"</span><span class="s4"> </span><span class="s2">viewBox</span><span class="s3">=</span><span class="s1">"0 0 24 24"</span><span class="s4"> </span><span class="s2">xmlns</span><span class="s3">=</span><span class="s1">"http://www.w3.org/2000/svg"</span><span class="s3">&gt;&lt;</span><span class="s6">path</span><span class="s4"> </span><span class="s2">stroke-linecap</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s2">stroke-linejoin</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s2">stroke-width</span><span class="s3">=</span><span class="s1">"2"</span><span class="s4"> </span><span class="s2">d</span><span class="s3">=</span><span class="s1">"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"</span><span class="s3">&gt;&lt;/</span><span class="s6">path</span><span class="s3">&gt;&lt;/</span><span class="s6">svg</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> prompts </span><span class="s7">=</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>discussion</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>title</span><span class="s7">:</span><span class="s1"> </span><span class="s9">"ディスカッションの練習"</span><span class="s7">,</span></p>
<p class="p7"><span class="s12"><span class="Apple-converted-space">                </span>system</span><span class="s13">:</span><span class="s12"> </span><span class="s11">"あなたは高校3年生のディスカッション練習をサポートする先生です。生徒が論理的思考力と表現力を身につけることを目標とし、フレンドリーで支援的な雰囲気を作ります。\n基本方針\n- 高校生に適した語彙と表現を使用し、親しみやすく丁寧に対応する\n- 生徒の意見を否定せず、建設的な質問で思考を深める\n- 根拠に基づいた議論の重要性を教え、具体例を求める\n- 中立的な立場を保ち、特定の結論に誘導しない\n- 段階的に議論を深め、生徒の成長を促す\n会話の開始\n必ず以下のメッセージで会話を始めてください：\n「こんにちは！今日は一緒にディスカッションの練習をしましょう。今日はなにについて話し合いますか？」\nテーマが思い浮かばない場合は以下を提案：\n- 制服は必要かどうか\n- スマートフォンの使用時間について\n- アルバイトのメリット・デメリット\n- 環境問題への取り組み\n- SNSの影響について\n- 大学進学の意義\n- 部活動の在り方\n- 校則について\nディスカッションの進行（5段階）\n段階1: 意見表明\n生徒の基本的な考えや立場を自由に聞く。批判や評価は避ける。\n発言例：「[テーマ]について、まずはあなたの率直な考えを聞かせてください」\n段階2: 根拠の探求\n「なぜそう思うのですか？」「具体例はありますか？」で根拠を求める。\n発言例：「その考えに至った理由を教えてください。具体的な体験や事例があれば聞かせてください」\n段階3: 深掘りと具体化\n抽象的な概念を具体化し、詳細な議論へ発展させる。\n発言例：「それが実際に適用された場合、どのような影響が考えられますか？」\n段階4: 多角的視点の検討\n異なる立場や反対意見について考察を促す（最重要段階）。\n発言例：「反対の立場の人はどのような意見を持つでしょうか？その人たちの気持ちも考えてみませんか？」\n段階5: 統合と振り返り\n議論全体を整理し、学びを言語化してもらう。\n発言例：「今日の議論を通じて、あなたの考えに変化はありましたか？新しく気づいたことを教えてください」\n禁止事項\n- 政治的・宗教的偏見の押し付け\n- 個人攻撃や差別的発言の容認\n- 一方的な講義形式の会話\n- 生徒の意見の否定や批判\n- 特定の結論への誘導\n会話終了時\n- 議論の要点を簡潔にまとめる\n- 生徒の成長した点を具体的に褒める\n- 次回への改善提案を1-2点に絞って伝える\n- 「お疲れ様でした！また一緒に議論しましょう」で締めくくる\n上記の方針に従って、生徒が安心してディスカッションスキルを向上できるようサポートしてください。"</span><span class="s13">,</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>initialMessage</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"こんにちは！今日は一緒にディスカッションの練習をしましょう。今日はなにについて話し合いますか？"</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>brainstorming</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>title</span><span class="s7">:</span><span class="s1"> </span><span class="s9">"ブレーンストーミングの練習"</span><span class="s7">,</span></p>
<p class="p7"><span class="s12"><span class="Apple-converted-space">                </span>system</span><span class="s13">:</span><span class="s12"> </span><span class="s11">"あなたは高校3年生のブレーンストーミング練習をサポートする先生です。生徒が創造的思考力と協働的な発想スキルを身につけることを目標とし、安心して自由にアイデアを出せる雰囲気を作ります。\n基本方針\n- 高校生に適した語彙と表現を使用し、親しみやすく励ましの言葉をかける\n- どんなアイデアも肯定的に受け止め、創造性を最大限に引き出す\n- ブレーンストーミングの4つの基本原則を徹底的に実践させる\n- 批判や評価は一切せず、常に「面白い！」「いいですね！」で反応する\n- 量を重視し、質の判断は後回しにする姿勢を徹底する\n会話の開始\n必ず以下のメッセージで会話を始めてください：\n「こんにちは！今日は一緒にブレーンストーミングの練習をしましょう。ブレーンストーミングは『みんなでたくさんのアイデアを出し合って、より良い解決策を見つける技法』です。どんな突拍子もないアイデアでも大歓迎！今日はどんなテーマでブレーンストーミングしてみたいですか？」\n4つの基本ルール\nテーマが決まったら、必ず以下の4つのルールを詳しく説明してから開始：\n1. 批判禁止ルール\n「ブレーンストーミング中は絶対に批判をしません。『でも』『しかし』『無理だよ』『変だよ』は禁止です。どんなアイデアも『いいですね』『面白い』『なるほど』で受け止めます。まずは思いついたことを何でも言ってみてください」\n2. 自由奔放ルール\n「常識や現実にとらわれず、自由に発送しましょう。突拍子もないアイデア、実現不可能に見えるアイデアも大歓迎です。『もしも魔法が使えたら』『お金が無限にあったら』という気持ちで考えてみてください」\n3. 質より量ルール\n「良いアイデアかどうかは後で判断します。今は『とにかくたくさん』を目指しましょう。目標は最低15個のアイデアを出すことです。思いついたらすぐに言ってください」\n4. 結合改善ルール\n「出てきたアイデア同士を組み合わせたり、発展させたりするのは大歓迎です。『それにプラスして』『それを応用すると』『それと○○を組み合わせると』という発想を大切にしましょう」\n禁止事項\n- ブレーンストーミング中のアイデアの批判や評価\n- 実現可能性を問う質問\n- 一つのアイデアに固執させること\n- 正解を求める誘導\n- 競争的な雰囲気作り\n会話終了時\n- 「今日は素晴らしいブレーンストーミングでした！」\n- 「○個ものアイデアが出て、とても充実した時間でしたね」\n- 出てきたアイデアの中から特に印象的だったものを2-3個取り上げて褒める\n- 「お疲れ様でした！また一緒にブレーンストーミングを楽しみましょう！」\n上記の方針に従って、生徒がブレーンストーミングの正しい技法を身につけられるようサポートしてください。"</span><span class="s13">,</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>initialMessage</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"こんにちは！今日は一緒にブレーンストーミングの練習をしましょう。ブレーンストーミングは『みんなでたくさんのアイデアを出し合って、より良い解決策を見つける技法』です。どんな突拍子もないアイデアでも大歓迎！今日はどんなテーマでブレーンストーミングしてみたいですか？"</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>ideation</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>title</span><span class="s7">:</span><span class="s1"> </span><span class="s9">"アイデア出しの練習"</span><span class="s7">,</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>system</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"あなたは高校3年生のアイデア出し練習をサポートする先生です。生徒が創造的思考力と自由な発想力を身につけることを目標とし、楽しく安心できる雰囲気を作りながら、アイデア創出の基本技術を教えます。\n基本方針\n- 高校生に適した語彙と表現を使用し、親しみやすく励ましの言葉をかける\n- どんなアイデアも肯定的に受け止め、創造性を最大限に引き出す\n- 批判や評価は一切せず、常に「面白い！」「いいですね！」で反応する\n- 量を重視し、質の判断は後回しにする姿勢を徹底する\n会話の開始\n必ず以下のメッセージで会話を始めてください：\n「こんにちは！今日は一緒にアイデア出しの練習をしましょう。アイデア出しは『正解のない自由な発想タイム』です。どんな突拍子もないアイデアでも大歓迎！今日はどんなテーマでアイデアを出してみたいですか？」\n4つの基本ルール\nテーマが決まったら、必ず以下の4つのルールを説明してから開始：\n1. 批判禁止ルール\n「どんなアイデアも批判しません！『無理だよ』『変だよ』は禁止です。すべてのアイデアを『面白い！』で受け止めます」\n2. 自由奔放ルール\n「常識なんて忘れましょう！突拍子もないアイデア、ばかばかしいアイデア大歓迎です」\n3. 質より量ルール\n「質より量です！たくさんのアイデアを目指しましょう。良いアイデアかどうかは後で考えます」\n4. 結合改善ルール\n「出てきたアイデア同士を組み合わせたり、発展させたりしてもOKです」\n禁止事項\n- アイデアの批判、否定、評価\n- 「それは無理」「現実的じゃない」などの発言\n- 正解を求める質問や誘導\n- 実現可能性を問う質問\n会話終了時\n- 「今日はたくさんの素晴らしいアイデアが出ましたね！」\n- 「アイデア出しは『正解のない自由な時間』だということを実感できましたか？」\n- 「お疲れ様でした！また一緒にアイデア出しを楽しみましょう！」\n上記の方針に従って、生徒が自由で創造的なアイデア出しを体験し、発想力を向上できるようサポートしてください。"</span><span class="s7">,</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>initialMessage</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"こんにちは！今日は一緒にアイデア出しの練習をしましょう。アイデア出しは『正解のない自由な発想タイム』です。どんな突拍子もないアイデアでも大歓迎！今日はどんなテーマでアイデアを出してみたいですか？"</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> modeSelectionContainer </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s9">'mode-selection'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> chatbotContainer </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s9">'chatbot-container'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> chatbotTitle </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s9">'chatbot-title'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> recordButton </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s9">'recordButton'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> statusElement </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s9">'status'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> chatContainer </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s9">'chat-container'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> micIcon </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s9">'micIcon'</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> isRecording </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> isMicPermissionGranted </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> conversationHistory </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentSystemPrompt </span><span class="s7">=</span><span class="s1"> </span><span class="s9">""</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentInitialMessage </span><span class="s7">=</span><span class="s1"> </span><span class="s9">""</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> apiKeyFailed </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> japaneseVoice </span><span class="s7">=</span><span class="s1"> </span><span class="s10">null</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> </span><span class="s14">SpeechRecognition</span><span class="s1"> </span><span class="s7">=</span><span class="s1"> window</span><span class="s7">.</span><span class="s14">SpeechRecognition</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> window</span><span class="s7">.</span><span class="s1">webkitSpeechRecognition</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> recognition</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s10">if</span><span class="s4"> </span><span class="s7">(</span><span class="s1">SpeechRecognition</span><span class="s7">)</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recognition </span><span class="s7">=</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s14">SpeechRecognition</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recognition</span><span class="s7">.</span><span class="s1">lang </span><span class="s7">=</span><span class="s1"> </span><span class="s9">'ja-JP'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recognition</span><span class="s7">.</span><span class="s1">interimResults </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recognition</span><span class="s7">.</span><span class="s1">continuous </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> heading </span><span class="s7">=</span><span class="s1"> modeSelectionContainer</span><span class="s7">.</span><span class="s1">querySelector</span><span class="s7">(</span><span class="s9">'h1'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>heading</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"エラー"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> grid </span><span class="s7">=</span><span class="s1"> modeSelectionContainer</span><span class="s7">.</span><span class="s1">querySelector</span><span class="s7">(</span><span class="s9">'.grid'</span><span class="s7">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>grid</span><span class="s7">.</span><span class="s4">innerHTML </span><span class="s7">=</span><span class="s4"> </span><span class="s1">"&lt;p&gt;お使いのブラウザは音声認識に対応していません。&lt;/p&gt;"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> loadVoices</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> voices </span><span class="s7">=</span><span class="s1"> speechSynthesis</span><span class="s7">.</span><span class="s1">getVoices</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>japaneseVoice </span><span class="s7">=</span><span class="s1"> voices</span><span class="s7">.</span><span class="s1">find</span><span class="s7">(</span><span class="s1">voice </span><span class="s7">=&gt;</span><span class="s1"> voice</span><span class="s7">.</span><span class="s1">lang </span><span class="s7">===</span><span class="s1"> </span><span class="s9">'ja-JP'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> voices</span><span class="s7">.</span><span class="s1">find</span><span class="s7">(</span><span class="s1">voice </span><span class="s7">=&gt;</span><span class="s1"> voice</span><span class="s7">.</span><span class="s1">lang</span><span class="s7">.</span><span class="s1">startsWith</span><span class="s7">(</span><span class="s9">'ja'</span><span class="s7">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>loadVoices</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">speechSynthesis</span><span class="s7">.</span><span class="s1">onvoiceschanged </span><span class="s7">!==</span><span class="s1"> </span><span class="s10">undefined</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>speechSynthesis</span><span class="s7">.</span><span class="s1">onvoiceschanged </span><span class="s7">=</span><span class="s1"> loadVoices</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>modeSelectionContainer</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s9">'click'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">matches</span><span class="s7">(</span><span class="s9">'.mode-button'</span><span class="s7">))</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> mode </span><span class="s7">=</span><span class="s1"> e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">dataset</span><span class="s7">.</span><span class="s1">mode</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>startChat</span><span class="s7">(</span><span class="s1">mode</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> startChat</span><span class="s7">(</span><span class="s1">mode</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>modeSelectionContainer</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s9">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatbotContainer</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s9">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatbotContainer</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s9">'flex'</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> selectedPrompt </span><span class="s7">=</span><span class="s1"> prompts</span><span class="s7">[</span><span class="s1">mode</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatbotTitle</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> selectedPrompt</span><span class="s7">.</span><span class="s1">title</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentSystemPrompt </span><span class="s7">=</span><span class="s1"> selectedPrompt</span><span class="s7">.</span><span class="s1">system</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentInitialMessage </span><span class="s7">=</span><span class="s1"> selectedPrompt</span><span class="s7">.</span><span class="s1">initialMessage</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>conversationHistory </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[];</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>addMessageToChat</span><span class="s7">(</span><span class="s9">'assistant'</span><span class="s7">,</span><span class="s1"> currentInitialMessage</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>conversationHistory</span><span class="s7">.</span><span class="s1">push</span><span class="s7">({</span><span class="s1"> role</span><span class="s7">:</span><span class="s1"> </span><span class="s9">'model'</span><span class="s7">,</span><span class="s1"> content</span><span class="s7">:</span><span class="s1"> currentInitialMessage </span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"ボタンを押してマイクの許可と会話開始"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>recordButton</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s9">'click'</span><span class="s7">,</span><span class="s1"> </span><span class="s10">async</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">apiKeyFailed </span><span class="s7">||</span><span class="s1"> recordButton</span><span class="s7">.</span><span class="s1">disabled</span><span class="s7">)</span><span class="s1"> </span><span class="s10">return</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">isMicPermissionGranted</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">await</span><span class="s1"> requestMicrophonePermissionAndPlayGreeting</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">isRecording</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>recognition</span><span class="s7">.</span><span class="s1">stop</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>startRecording</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">recognition</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recognition</span><span class="s7">.</span><span class="s1">onstart </span><span class="s7">=</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>isRecording </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>recordButton</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s9">'recording'</span><span class="s7">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>micIcon</span><span class="s7">.</span><span class="s4">innerHTML </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14" /&gt;`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"聞いています..."</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recognition</span><span class="s7">.</span><span class="s1">onend </span><span class="s7">=</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>isRecording </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>recordButton</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s9">'recording'</span><span class="s7">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>micIcon</span><span class="s7">.</span><span class="s4">innerHTML </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"&gt;&lt;/path&gt;`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"ボタンを押して応答してください"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recognition</span><span class="s7">.</span><span class="s1">onresult </span><span class="s7">=</span><span class="s1"> </span><span class="s10">async</span><span class="s1"> </span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> transcript </span><span class="s7">=</span><span class="s1"> event</span><span class="s7">.</span><span class="s1">results</span><span class="s7">[</span><span class="s15">0</span><span class="s7">][</span><span class="s15">0</span><span class="s7">].</span><span class="s1">transcript</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">transcript</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>addMessageToChat</span><span class="s7">(</span><span class="s9">'user'</span><span class="s7">,</span><span class="s1"> transcript</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">await</span><span class="s1"> getAIResponse</span><span class="s7">(</span><span class="s1">transcript</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recognition</span><span class="s7">.</span><span class="s1">onerror </span><span class="s7">=</span><span class="s1"> </span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s9">'Speech recognition error:'</span><span class="s7">,</span><span class="s1"> event</span><span class="s7">.</span><span class="s1">error</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">event</span><span class="s7">.</span><span class="s1">error </span><span class="s7">===</span><span class="s1"> </span><span class="s9">'not-allowed'</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> event</span><span class="s7">.</span><span class="s1">error </span><span class="s7">===</span><span class="s1"> </span><span class="s9">'service-not-allowed'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"マイクへのアクセスがブロックされました。"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>recordButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">`音声認識エラー: </span><span class="s7">${</span><span class="s1">event</span><span class="s7">.</span><span class="s1">error</span><span class="s7">}</span><span class="s9">`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> handleApiError</span><span class="s7">(</span><span class="s1">apiName</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>apiKeyFailed </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> errorMessage </span><span class="s7">=</span><span class="s1"> </span><span class="s9">`</span><span class="s7">${</span><span class="s1">apiName</span><span class="s7">}</span><span class="s9"> APIでエラーが発生しました。詳細: </span><span class="s7">${</span><span class="s1">error</span><span class="s7">.</span><span class="s1">message</span><span class="s7">}</span><span class="s9">`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"エラーが発生しました。ページを再読み込みしてください。"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>statusElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s9">'text-red-400'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>addMessageToChat</span><span class="s7">(</span><span class="s9">'error'</span><span class="s7">,</span><span class="s1"> errorMessage</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recordButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recordButton</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s9">'bg-gray-500'</span><span class="s7">,</span><span class="s1"> </span><span class="s9">'cursor-not-allowed'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recordButton</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s9">'bg-blue-600'</span><span class="s7">,</span><span class="s1"> </span><span class="s9">'hover:bg-blue-700'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> requestMicrophonePermissionAndPlayGreeting</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"マイクの使用許可を待っています..."</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> stream </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> navigator</span><span class="s7">.</span><span class="s1">mediaDevices</span><span class="s7">.</span><span class="s1">getUserMedia</span><span class="s7">({</span><span class="s1"> audio</span><span class="s7">:</span><span class="s1"> </span><span class="s10">true</span><span class="s1"> </span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>stream</span><span class="s7">.</span><span class="s1">getTracks</span><span class="s7">().</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">track </span><span class="s7">=&gt;</span><span class="s1"> track</span><span class="s7">.</span><span class="s1">stop</span><span class="s7">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>isMicPermissionGranted </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">await</span><span class="s1"> speakText</span><span class="s7">(</span><span class="s1">currentInitialMessage</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">err</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">'Permission or initial setup error:'</span><span class="s7">,</span><span class="s4"> err</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">let</span><span class="s1"> errorMessage</span><span class="s7">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                 </span></span><span class="s10">if</span><span class="s4"> </span><span class="s7">(</span><span class="s4">err</span><span class="s7">.</span><span class="s4">name </span><span class="s7">===</span><span class="s4"> </span><span class="s1">'NotAllowedError'</span><span class="s4"> </span><span class="s7">||</span><span class="s4"> err</span><span class="s7">.</span><span class="s4">name </span><span class="s7">===</span><span class="s4"> </span><span class="s1">'PermissionDeniedError'</span><span class="s7">)</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span>errorMessage </span><span class="s7">=</span><span class="s4"> </span><span class="s1">"マイクへのアクセスが拒否されました。Googleサイトのような埋め込み環境では、セキュリティ上の理由からマイクが動作しないことがあります。このHTMLファイルをPCに保存し、直接ブラウザで開いてお試しください。"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>errorMessage </span><span class="s7">=</span><span class="s1"> </span><span class="s9">`マイクまたは初期設定でエラーが発生しました: </span><span class="s7">${</span><span class="s1">err</span><span class="s7">.</span><span class="s1">message</span><span class="s7">}</span><span class="s9">`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> errorMessage</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>addMessageToChat</span><span class="s7">(</span><span class="s9">'error'</span><span class="s7">,</span><span class="s1"> errorMessage</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>recordButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> startRecording</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">recognition</span><span class="s7">)</span><span class="s1"> </span><span class="s10">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>recognition</span><span class="s7">.</span><span class="s1">start</span><span class="s7">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s9">"Could not start recognition:"</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">);</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"録音を開始できませんでした。"</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> addMessageToChat</span><span class="s7">(</span><span class="s1">sender</span><span class="s7">,</span><span class="s1"> text</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> bubble </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s9">'div'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> senderClass </span><span class="s7">=</span><span class="s1"> </span><span class="s9">'assistant-bubble'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">sender </span><span class="s7">===</span><span class="s1"> </span><span class="s9">'user'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>senderClass </span><span class="s7">=</span><span class="s1"> </span><span class="s9">'user-bubble'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">sender </span><span class="s7">===</span><span class="s1"> </span><span class="s9">'error'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>senderClass </span><span class="s7">=</span><span class="s1"> </span><span class="s9">'error-bubble'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>bubble</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s9">`chat-bubble fade-in </span><span class="s7">${</span><span class="s1">senderClass</span><span class="s7">}</span><span class="s9">`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>bubble</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> text</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatContainer</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">bubble</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatContainer</span><span class="s7">.</span><span class="s1">scrollTop </span><span class="s7">=</span><span class="s1"> chatContainer</span><span class="s7">.</span><span class="s1">scrollHeight</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> formatConversationForGemini</span><span class="s7">(</span><span class="s1">history</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> history</span><span class="s7">.</span><span class="s1">map</span><span class="s7">(</span><span class="s1">msg </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">({</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>role</span><span class="s7">:</span><span class="s1"> msg</span><span class="s7">.</span><span class="s1">role </span><span class="s7">===</span><span class="s1"> </span><span class="s9">'assistant'</span><span class="s1"> </span><span class="s7">?</span><span class="s1"> </span><span class="s9">'model'</span><span class="s1"> </span><span class="s7">:</span><span class="s1"> msg</span><span class="s7">.</span><span class="s1">role</span><span class="s7">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>parts</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[{</span><span class="s1"> text</span><span class="s7">:</span><span class="s1"> msg</span><span class="s7">.</span><span class="s1">content </span><span class="s7">}]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> getAIResponse</span><span class="s7">(</span><span class="s1">userText</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"AIが考えています..."</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recordButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>conversationHistory</span><span class="s7">.</span><span class="s1">push</span><span class="s7">({</span><span class="s1"> role</span><span class="s7">:</span><span class="s1"> </span><span class="s9">"user"</span><span class="s7">,</span><span class="s1"> content</span><span class="s7">:</span><span class="s1"> userText </span><span class="s7">});</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// ★★★ 修正箇所 ★★★</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// APIキーを直接使わず、プロキシサーバーを呼び出すように変更</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s4"> url </span><span class="s7">=</span><span class="s4"> </span><span class="s9">`/api/proxy`</span><span class="s7">;</span><span class="s4"> </span><span class="s1">// Vercelのプロキシエンドポイント</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> payload </span><span class="s7">=</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>contents</span><span class="s7">:</span><span class="s1"> formatConversationForGemini</span><span class="s7">(</span><span class="s1">conversationHistory</span><span class="s7">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>system_instruction</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>parts</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[{</span><span class="s1"> text</span><span class="s7">:</span><span class="s1"> currentSystemPrompt </span><span class="s7">}]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>safety_settings</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">{</span><span class="s4"> </span><span class="s1">"category"</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"HARM_CATEGORY_HARASSMENT"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"threshold"</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"BLOCK_NONE"</span><span class="s4"> </span><span class="s7">},</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">{</span><span class="s4"> </span><span class="s1">"category"</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"HARM_CATEGORY_HATE_SPEECH"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"threshold"</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"BLOCK_NONE"</span><span class="s4"> </span><span class="s7">},</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">{</span><span class="s4"> </span><span class="s1">"category"</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"HARM_CATEGORY_SEXUALLY_EXPLICIT"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"threshold"</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"BLOCK_NONE"</span><span class="s4"> </span><span class="s7">},</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">{</span><span class="s4"> </span><span class="s1">"category"</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"HARM_CATEGORY_DANGEROUS_CONTENT"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"threshold"</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"BLOCK_NONE"</span><span class="s4"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// ヘッダーからAPIキーを削除</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> response </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> fetch</span><span class="s7">(</span><span class="s1">url</span><span class="s7">,</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>method</span><span class="s7">:</span><span class="s1"> </span><span class="s9">'POST'</span><span class="s7">,</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span>headers</span><span class="s7">:</span><span class="s4"> </span><span class="s7">{</span><span class="s4"> </span><span class="s1">'Content-Type'</span><span class="s7">:</span><span class="s4"> </span><span class="s1">'application/json'</span><span class="s4"> </span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>body</span><span class="s7">:</span><span class="s1"> </span><span class="s14">JSON</span><span class="s7">.</span><span class="s1">stringify</span><span class="s7">(</span><span class="s1">payload</span><span class="s7">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> responseData </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> response</span><span class="s7">.</span><span class="s1">json</span><span class="s7">();</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">response</span><span class="s7">.</span><span class="s1">ok</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">throw</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s14">Error</span><span class="s7">(</span><span class="s1">responseData</span><span class="s7">.</span><span class="s1">error</span><span class="s7">?.</span><span class="s1">message </span><span class="s7">||</span><span class="s1"> </span><span class="s9">`HTTP error! status: </span><span class="s7">${</span><span class="s1">response</span><span class="s7">.</span><span class="s1">status</span><span class="s7">}</span><span class="s9">`</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">responseData</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">?.[</span><span class="s15">0</span><span class="s7">]?.</span><span class="s1">content</span><span class="s7">?.</span><span class="s1">parts</span><span class="s7">?.[</span><span class="s15">0</span><span class="s7">]?.</span><span class="s1">text</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">responseData</span><span class="s7">.</span><span class="s1">promptFeedback</span><span class="s7">?.</span><span class="s1">blockReason</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> reason </span><span class="s7">=</span><span class="s1"> responseData</span><span class="s7">.</span><span class="s1">promptFeedback</span><span class="s7">.</span><span class="s1">blockReason</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">throw</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s14">Error</span><span class="s7">(</span><span class="s9">`リクエストがブロックされました。理由: </span><span class="s7">${</span><span class="s1">reason</span><span class="s7">}</span><span class="s9">`</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">throw</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s14">Error</span><span class="s7">(</span><span class="s9">"APIからのレスポンスが無効です。"</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> assistantResponseText </span><span class="s7">=</span><span class="s1"> responseData</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s15">0</span><span class="s7">].</span><span class="s1">content</span><span class="s7">.</span><span class="s1">parts</span><span class="s7">[</span><span class="s15">0</span><span class="s7">].</span><span class="s1">text</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>conversationHistory</span><span class="s7">.</span><span class="s1">push</span><span class="s7">({</span><span class="s1"> role</span><span class="s7">:</span><span class="s1"> </span><span class="s9">"model"</span><span class="s7">,</span><span class="s1"> content</span><span class="s7">:</span><span class="s1"> assistantResponseText </span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>addMessageToChat</span><span class="s7">(</span><span class="s9">'assistant'</span><span class="s7">,</span><span class="s1"> assistantResponseText</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">await</span><span class="s1"> speakText</span><span class="s7">(</span><span class="s1">assistantResponseText</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s9">'Error getting AI response:'</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>handleApiError</span><span class="s7">(</span><span class="s9">'Gemini'</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> speakText</span><span class="s7">(</span><span class="s1">textToSpeak</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"AIが話しています..."</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>recordButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s14">Promise</span><span class="s7">((</span><span class="s1">resolve</span><span class="s7">,</span><span class="s1"> reject</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">textToSpeak </span><span class="s7">||</span><span class="s1"> </span><span class="s10">typeof</span><span class="s1"> speechSynthesis </span><span class="s7">===</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">apiKeyFailed</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>recordButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"ボタンを押して応答してください"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">return</span><span class="s1"> resolve</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>speechSynthesis</span><span class="s7">.</span><span class="s1">cancel</span><span class="s7">();</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> utterance </span><span class="s7">=</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s14">SpeechSynthesisUtterance</span><span class="s7">(</span><span class="s1">textToSpeak</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">japaneseVoice</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>utterance</span><span class="s7">.</span><span class="s1">voice </span><span class="s7">=</span><span class="s1"> japaneseVoice</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s1">warn</span><span class="s7">(</span><span class="s9">"日本語の音声が見つかりません。デフォルトを使用します。"</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>utterance</span><span class="s7">.</span><span class="s1">lang </span><span class="s7">=</span><span class="s1"> </span><span class="s9">'ja-JP'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>utterance</span><span class="s7">.</span><span class="s1">rate </span><span class="s7">=</span><span class="s1"> </span><span class="s15">1.1</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>utterance</span><span class="s7">.</span><span class="s1">pitch </span><span class="s7">=</span><span class="s1"> </span><span class="s15">1</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>utterance</span><span class="s7">.</span><span class="s1">onend </span><span class="s7">=</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">apiKeyFailed</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>recordButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"ボタンを押して応答してください"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>resolve</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>utterance</span><span class="s7">.</span><span class="s1">onerror </span><span class="s7">=</span><span class="s1"> </span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s9">'SpeechSynthesis Error:'</span><span class="s7">,</span><span class="s1"> event</span><span class="s7">.</span><span class="s1">error</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>addMessageToChat</span><span class="s7">(</span><span class="s9">'error'</span><span class="s7">,</span><span class="s1"> </span><span class="s9">`音声再生エラー: </span><span class="s7">${</span><span class="s1">event</span><span class="s7">.</span><span class="s1">error</span><span class="s7">}</span><span class="s9">`</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">apiKeyFailed</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>recordButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>statusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s9">"ボタンを押して応答してください"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>reject</span><span class="s7">(</span><span class="s1">event</span><span class="s7">.</span><span class="s1">error</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>speechSynthesis</span><span class="s7">.</span><span class="s1">speak</span><span class="s7">(</span><span class="s1">utterance</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
</body>
</html>
